#§DB基礎
##1. DB概要
###1-1. DBとは  
DB(データベース)とは一定のルールで管理されたデータの集合体のことを指し、一般的に複数の表でデータ同士の関係を定義し、管理するRDB(リレーショナルデータベース)を指します。
RDBを管理するソフトウェアをリレーショナルデータベースマネージメントシステム(RDBMS)と言います。

###1-2. DBの種類  
現在以下のRDBMSが市場の大部分のシェアを占めています。  
・Oracle  
・MySQL  
・Microsoft SQL Server  
・DB2  
・PostgreSQL  

同じRDMBSでも信頼性、拡張性、高可用性などシステムに求められる要件や予算に応じて商用やオープンソースのRDBMSが選定され、使用されています。  

商用RDBMSの代表的なものがOracleやDB2となり、大規模で堅牢性の高いシステムで用いられることが多く、大企業を中心に幅広く利用されています。  

オープンソースのRDBMSの代表的なものはMySQLやPostgreSQLとなり、大企業や中小企業問わず幅広く利用されており、小規模なシステムから大規模なシステムまで用途も様々です。  

###1-3. DB使用例
実際にシステム上ではどのように使用されているかの具体例(フォームで登録されたデータを格納、それを参照してなんとかみたいなイメージが分かるようなものを図で説明)

##2. MySQL操作
ここではMySQLの使用方法について説明します。  
以降の説明は全てMySQLログイン後のコマンドライン上の操作となります。

- MySQLログイン方法  
① コマンドラインで以下を入力  
mysql -u(ユーザ名) -p  
②パスワードを入力  
「Enter password:」と表示されるので、パスワードを入力する。  
ログインが成功すると、Welcomeメッセージが表示され、プロンプト「mysql>」が表示されます。  

- MySQLログアウト方法  
コマンドライン上で「exit」もしくは、「\q」と入力し、Enterキー押下。  

###2-1. DB作成、選択(useコマンド)
RDBMSはデータベースという入れ物の中にテーブル(表)があり、そのテーブルの中にデータが格納されるという構成となります。  
MySQLをインストールすると、デフォルトでmysql,information_schemaなどの管理用DBが作成されていますが、
アプリケーションで使用する為のDBをまずは作成する必要があります。  

- 新規データベース作成コマンド  
create database データベース名;

- 作成したデータベースへのアクセス  
use データベース名;

###2-2. DB、テーブルの一覧表示コマンド(show databases, show tables)
既存のものや新規作成したものなど、アクセスしたMySQLにどのようなDBがあり、どのようなテーブルが格納されているかについて以下のコマンドで確認が出来ます。  

- データベース一覧表示コマンド  
show databases;  

- テーブル一覧表示コマンド(※対象のDBを事前にuseで指定する必要があります)
show tables;  

###2-3. テーブル定義の確認コマンド(desc)
テーブルに格納されているデータを確認する方法は後述しますが、どのような定義のテーブルにデータが入っているのかを以下のコマンドで確認できます。  

- テーブル定義確認コマンド  
desc テーブル名;  

###2-4. アカウント作成・削除、権限付与・削除
各DBにアクセスするアカウントを作成し、利用可能な操作(権限)を設定することが出来ます。  
作成したアカウントは削除、権限のみの変更も可能です。  
実際に公開するシステムの場合は、セキュリティ、データ保護の観点から、用途に応じた必要最低限のアカウント作成、権限に抑えることに留意して下さい。

- アカウント作成コマンド  
create user ユーザ名 identified by 'パスワード';  

- 権限付与コマンド
grant 権限名 on 対象DB名.対象テーブル名 to 対象ユーザ名;  

- 権限削除コマンド
revoke 権限名 on 対象DB名.対象テーブル名 from 対象ユーザ名;  

- 現在の権限の確認コマンド
show grants for 対象ユーザ名;

- アカウント削除コマンド
drop user 対象ユーザ名;

###2-5. アカウントの権限の種類について
付与可能な権限はMySQL公式ページを参照。  
https://dev.mysql.com/doc/refman/5.6/ja/privileges-provided.html  

###2-6. SQLの実行(SQL実行、出力結果整形等(\G))
テーブルへのデータ登録、登録されているデータの確認や更新、削除にはSQLと呼ばれる言語を使用します(詳細は第3章で説明)。  

例えば、コマンドラインから以下のようなSQLを実行するとデータの参照ができます。  

- (例)  
select * from test;  
※SQLは大文字、小文字どちらでも問題ありませんが、テーブル名はデフォルト設定だと大文字、小文字の区別がされるので注意が必要です。 
※テーブル名、カラム名はtabキーで入力補完されます。  

###2-7. その他コマンドプロンプト小技
#### \G
- SQLでデータ参照の際、末尾に「;」の代わりに「\G」を指定すると、抽出データを縦に表示させ見やすく表示することが出来ます(テーブルのカラム数が多い場合に重宝します)。  

#### \c
- 入力途中のSQLをキャンセルしたい場合、「\c」と入力すると中途半端な状態で実行やSQLを削除しなくても改行されて、途中でキャンセルされます。  

#### \s
- DBへの接続情報が表示されます。  

#### \q
- MySQLからログアウト



##3.テーブル定義、データ操作基礎
この章では、実際にデータを格納するテーブルの作成方法や更新、削除方法及び、テーブルを使用したデータ操作(登録、参照、更新、削除)について説明します。  

###DDL
DDLとはData Definition Languageの略で、データベースのテーブルの定義を行う言語です。  
テーブル作成や変更方法、削除などの基本的なDDLについて説明

#### テーブル作成
以下のDDLでデータを格納するテーブルが作成できます。  
create table テーブル名 (カラム名1 データ型 制約 制約・・, カラム名2 データ型 制約 制約・・・,);  
※データ型や制約については次項以降で説明します。  

#### データ型(varchar, int, date, datetime, timestamp, text, blob, enum)
テーブルに格納するデータの種類をデータ型を指定することで制限することが出来ます。  
データ型の種類は公式ページを参照(https://dev.mysql.com/doc/refman/5.6/ja/data-types.html)

##### 各データ型の使い分け等について
- 数値型(tinyint,smallint,mediumint,int,bigint)
数値データのみを格納できるデータ型。格納するデータの最大サイズに応じて、tinyintやsmallint,intなどを使い分けて使用。  
(使用例)  
tinyint型 性別などのフラグや分類などのフラグを格納など  
int型 部署ごとの売上やIDの格納など  

- 日付型(date,datetime,timestamp)
日付形式のデータのみを格納できるデータ型。  
日付のみか時間まで保持するかにより、使い分けて使用。  
(使用例)  
date型 生年月日、有効期日データの格納など  
datetime型 アクセス日時や登録日時の格納など(MySQL 5.6.5以降のバージョンではtimestamp型と同様に自動で更新日時を設定することが可能となりました) 
timestamp型 アクセス日時や登録日時の格納など

- 文字列型1(varchar)
数百文字程度(半角、全角問わず)までの任意のテキスト文字列を格納するのに適しているデータ型。定義する際に最大使用サイズを指定して定義します。
(使用例)氏名、住所、メールアドレスの格納など

- 文字列型2(tinytext,text,mediumtext,longtext)
varchar型よりサイズの大きいテキスト文字列を格納する場合に適しているデータ型。
それぞれの型で格納できる最大サイズは決まっている為、用途により使い分けを行います。
(使用例)
紹介文や説明文等、数百〜数千文字程度の文字数が格納される可能性があるデータの格納など

- バイナリ型(tinyblob,blob,mediumblob,longblob)
バイナリ形式のデータ型を格納する際に使用するデータ型。
それぞれの型で格納できる最大サイズは決まっている為、用途により使い分けを行います。
(使用例)
画像ファイルの格納など


#### 制約
- Not NUll制約
必須項目など、必ずデータを格納する項目に指定する。  

- キー制約(Primary Key, Unique Key, Foreign Key)
Primary Key  
主キーと呼ばれるテーブル内で一意の値を特定する為に使用するカラムに指定。  
複数項目で一つの主キーとすることも可能。  
このキーを設定した項目は同時にNOT NULL制約が付与され、後述のインデックスも設定される。  
(使用例)  
・ユーザ情報テーブルのユーザIDに指定  
・グループメンバーテーブルのグループID、メンバーIDに指定(複数指定時)  

Unique Key  
主キーとしては使用しないが、一意性のみを保持したい場合に指定。  
(使用例)  
ユーザ情報テーブルのメールアドレスの指定

- デフォルト値  
テーブルへのデータ登録時に何も指定されていなかった場合に設定する値を指定。
(使用例)  
・商品マスタ(商品情報テーブル)の金額項目未指定時に0をセット  
・登録日時項目未指定時に現在時刻をセット  

- Auto Increment
自動で数値項目の値を増やしたい際に指定。  
(使用例)  
・ユーザ情報テーブルのユーザID  
・商品マスタの商品ID  

- テーブル定義変更
カラムの追加  
alter table テーブル名 add(カラム名1 データ型 制約 制約・・, カラム名2 データ型 制約 制約・・・,);  

カラムの変更  
alter table テーブル名 modify(カラム名1 データ型 制約 制約・・, カラム名2 データ型 制約 制約・・・,);  

カラムの削除  
alter table テーブル名 drop(カラム名1, カラム名2, カラム名3);  


- テーブル削除
drop table テーブル名;  

- Index


###DML
テーブルに格納されているデータの登録、検索、更新、削除等の基本的なDMLについて説明。

- INSERT
- SELECT
- UPDATE
- DELETE
- 条件指定(WHERE句,AND, OR, NOT NULL, LIKE, BETWEEN)
- グループ化(GROUP BY, HAVING句)
- 順序指定(ORDER BY句)
- 取得件数、取得位置指定(LIMIT, OFFSET句)
- テーブル結合(JOIN)
- 関数(SUM, AVG, MAX, MIN, NOW)
- その他(AS, DISTINCT)

---
#§DB応用
##1. テーブルの種類について
MyISAM, InnoDBの違いについて

##2. データ取り込み、出力
dumpやcsvデータの出力や取り込みについて説明。

##3. 高度なデータ操作
### トランザクション制御(commit, rollback)
auto commitやトランザクションの制御方法について説明。

### 副問合せ
副問合せについて説明。

### データ登録or更新(ON DUPLICATE KEY UPDATE)
使用方法について説明。

##3. その他(ここあたりは不要かも)
パフォーマンスチューニング系
- Explain
- レプリケーション
- パーティショニング

DDLその他
- Trigger
- View

---
#RubyとDBの連携(Active Record)
##1. Active Recordとは
- Active Record、ORMについて
- 使用ルールについて(命名規則など)

##2. Active Recordによるデータ操作
- データ操作方法について(CRUD)
- バリデーションについて
- コールバックについて
- マイグレーションについて



↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓ 作成中 ↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓
#実践、課題案
※基本的なSQLのCRUDの習得にはテストデータが予めあった方が取り組みやすいので、事前に課題用のDB、テーブル、データ一式を用意して、dumpデータとして学習環境に取り込んでもらい、それに対して課題を消化してもらう想定。
##★
- practice.userテーブルから住所が東京のデータのみを抽出せよ。
- practice.userテーブルから住所が北海道でメールアドレスを持っていないユーザのみを抽出せよ。
- COUNT関数を使用して、埼玉県が登録住所のユーザの数を出力せよ

##★★
##★★★
- COUNT関数、GROUP BY句を使用して、都道府県別のが登録ユーザの数を出力せよ

##★★★★
##★★★★★
